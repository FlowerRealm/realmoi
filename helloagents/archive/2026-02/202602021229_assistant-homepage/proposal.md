# 变更提案: assistant-homepage

## 元信息
```yaml
类型: 重构
方案类型: implementation
优先级: P0
状态: ✅完成
创建: 2026-02-02
```

---

## 1. 需求

### 背景
当前前端已接入新调题助手 UI（Portal/Cockpit），但挂载在 `/assistant`，并且项目仍保留旧的 Jobs/Admin/Billing/Settings 页面与 Shell 导航。

你希望“直接把这个做成主页”，并“丢掉原来的代码”，即：以新 UI 作为默认入口（`/`），同时移除旧页面路由与 Shell 结构，避免双前端心智负担。

### 目标
1) 将新调题助手 UI 从 `/assistant` 迁移为主页 `/`（登录后即进入）。
2) 移除旧的前端路由与页面实现（`/jobs`、`/admin`、`/billing`、`/settings/*` 等），只保留必要的鉴权入口（`/login`、`/signup`）。
3) 不改动后端逻辑与 API（仅前端路由与 UI 形态调整）。

### 约束条件
```yaml
时间约束: 立即生效（本次迭代完成后默认入口即为新 UI）
性能约束: 不新增后端负担；前端按原有 SSE 方式工作
兼容性约束: 后端 API 不变；登录/注册仍使用现有 `/api/auth/*`
业务约束: 不在浏览器端存放/调用上游密钥；所有 Job 仍走后端 runner
```

### 验收标准
- [√] 登录后访问 `/` 直接进入新调题助手 UI（Portal/Cockpit）
- [√] `/assistant` 不再作为主入口（已移除路由）
- [√] 旧路由 `/jobs`、`/admin`、`/billing`、`/settings/*` 不再存在
- [√] 前端 `npm run build` 通过；后端不需要任何改动即可继续工作

---

## 2. 方案

### 技术方案
在 `frontend/` 内进行路由与布局重构：

1) 主页替换：将 `frontend/src/app/page.tsx` 改为渲染新调题助手 UI（`AssistantApp` + `RequireAuth`）。
2) 移除旧路由：删除旧页面目录与相关组件（仅保留登录/注册页）。
3) 去掉 Shell：从 `layout.tsx` 移除 `Shell` 包装，让新 UI 以全屏方式渲染。
4) 登录/注册跳转：将成功登录后的 redirect 从 `/jobs` 改为 `/`。

### 影响范围
```yaml
涉及模块:
  - frontend（Next.js）: 路由结构与布局调整、删除旧页面
预计变更文件: 10-30（含删除）
```

### 风险评估
| 风险 | 等级 | 应对 |
|------|------|------|
| 删除旧页面导致无法再通过 Web 管理模型/用户 | 中 | 本次按你的要求“丢掉旧代码”；如需恢复管理面板，后续单独重做或用其他方式管理 |
| 用户书签指向旧路由 | 低 | 允许后续补充 301/重定向（可选） |

---

## 3. 技术设计（可选）

> 涉及架构变更、API设计、数据模型变更时填写

### 架构设计
```mermaid
flowchart TD
    U[Browser: / (Assistant UI)] -->|REST| B[FastAPI /api]
    U -->|SSE terminal/agent_status| B
```

### API设计
本变更不新增/修改后端 API，仅调整前端路由与页面组织。

### 数据模型
本变更不新增后端数据模型。

---

## 4. 核心场景

> 执行完成后同步到对应模块文档

### 场景: 登录后进入主页调题助手
**模块**: frontend
**条件**: 用户已登录
**行为**: 访问 `/` 进入 Portal/Cockpit 并发起 Job
**结果**: 不再需要 `/assistant` 与旧 Jobs UI

---

## 5. 技术决策

> 本方案涉及的技术决策，归档后成为决策的唯一完整记录

### assistant-homepage#D001: 旧前端路由的处理方式
**日期**: 2026-02-02
**状态**: ✅采纳
**背景**: 需要明确“丢掉原来的代码”的执行方式：删除旧路由文件 vs 仅隐藏入口。
**选项分析**:
| 选项 | 优点 | 缺点 |
|------|------|------|
| A: 删除旧页面文件（路由彻底移除） | 代码库更干净；路由不会被误用 | 需要重新实现管理面板时成本更高 |
| B: 保留旧页面但移除入口 | 可随时回退/参考 | 路由仍可被访问；代码体积与心智负担保留 |
**决策**: 选择方案 A
**理由**: 你的要求是“丢掉原来的代码”，因此采用彻底删除以保证行为一致。
**影响**: 仅影响 `frontend/src/app/*` 旧路由与相关组件；后端不变
